MAP
  NAME "GFS"
  STATUS ON
  EXTENT -180 -90 180 90
  SIZE 256 256
  UNITS DD
  # Debug level 5 = maximum verbosity for performance profiling
  DEBUG 5
  CONFIG "MS_ERRORFILE" "stderr"
  CONFIG "CPL_VSIL_CURL_ALLOWED_EXTENSIONS" ".grb2 .grib2 .nc"
  CONFIG "CPL_DEBUG" "ON"
  CONFIG "GDAL_CACHEMAX" "512"
  CONFIG "GDAL_PAM_ENABLED" "YES"

  # Font for number labels
  FONTSET "/etc/mapserver/fonts/fonts.txt"

  WEB
    METADATA
      "wms_title"           "GFS on MapServer"
      "wms_onlineresource"  "http://localhost:8080/cgi-bin/mapserv?MAP=GFS&"
      "wms_enable_request"  "*"
      "wms_allow_getmap_without_styles" "true"
      "wms_srs"             "EPSG:4326 EPSG:3857"
    END
  END

  PROJECTION
    "init=epsg:4326"
  END

  # Symbols
  SYMBOL
    NAME "circle"
    TYPE ELLIPSE
    POINTS 1 1 END
    FILLED TRUE
  END

  #============================================================================
  # 2m TEMPERATURE - GRADIENT STYLE (default)
  # Data is in Celsius: approx -52C to +42C
  #============================================================================
  LAYER
    NAME "t2m"
    GROUP "temperature"
    TYPE RASTER
    STATUS ON
    DATA "/data/gfs.t12z.pgrb2.0p25.f000.grb2"
    PROCESSING "BANDS=580"
    PROCESSING "RESAMPLE=BILINEAR"
    OFFSITE 0 0 0
    CLASS
      NAME "< -30C"
      EXPRESSION ([pixel] < -30)
      STYLE
        COLORRANGE 20 20 120  40 80 180
        DATARANGE -55 -30
      END
    END
    CLASS
      NAME "-30C to -10C"
      EXPRESSION ([pixel] >= -30 AND [pixel] < -10)
      STYLE
        COLORRANGE 40 80 180  80 180 220
        DATARANGE -30 -10
      END
    END
    CLASS
      NAME "-10C to 5C"
      EXPRESSION ([pixel] >= -10 AND [pixel] < 5)
      STYLE
        COLORRANGE 80 180 220  80 200 80
        DATARANGE -10 5
      END
    END
    CLASS
      NAME "5C to 20C"
      EXPRESSION ([pixel] >= 5 AND [pixel] < 20)
      STYLE
        COLORRANGE 80 200 80  240 240 60
        DATARANGE 5 20
      END
    END
    CLASS
      NAME "20C to 35C"
      EXPRESSION ([pixel] >= 20 AND [pixel] < 35)
      STYLE
        COLORRANGE 240 240 60  240 140 40
        DATARANGE 20 35
      END
    END
    CLASS
      NAME "> 35C"
      EXPRESSION ([pixel] >= 35)
      STYLE
        COLORRANGE 240 140 40  180 20 20
        DATARANGE 35 50
      END
    END
    METADATA
      "wms_title" "2m Temperature (Gradient)"
      "wms_abstract" "Temperature at 2 meters - gradient colormap"
      "wms_style" "gradient"
    END
  END

  #============================================================================
  # 2m TEMPERATURE - CONTOUR STYLE
  #============================================================================
  LAYER
    NAME "t2m_contour"
    GROUP "temperature"
    TYPE LINE
    STATUS ON
    CONNECTIONTYPE CONTOUR
    DATA "/data/gfs.t12z.pgrb2.0p25.f000.grb2"
    PROCESSING "BANDS=580"
    PROCESSING "CONTOUR_INTERVAL=5"
    CLASS
      NAME "Isotherms"
      STYLE
        COLOR 80 80 80
        WIDTH 1.5
      END
      LABEL
        COLOR 40 40 40
        OUTLINECOLOR 255 255 255
        FONT "dejavu-bold"
        TYPE TRUETYPE
        SIZE 8
        POSITION AUTO
        ANGLE FOLLOW
        BUFFER 3
        MINDISTANCE 200
      END
    END
    METADATA
      "wms_title" "2m Temperature (Contours)"
      "wms_abstract" "Temperature contour lines every 5K"
      "wms_style" "contour"
    END
  END

  #============================================================================
  # 2m TEMPERATURE - NUMBERS STYLE (uses contour with labels only)
  # NOTE: This renders contour lines with prominent labels - simulates number display
  #============================================================================
  LAYER
    NAME "t2m_numbers"
    GROUP "temperature"
    TYPE LINE
    STATUS ON
    CONNECTIONTYPE CONTOUR
    DATA "/data/gfs.t12z.pgrb2.0p25.f000.grb2"
    PROCESSING "BANDS=580"
    PROCESSING "CONTOUR_INTERVAL=10"
    CLASS
      NAME "Temperature Labels"
      STYLE
        COLOR 200 200 200
        WIDTH 0.5
      END
      LABEL
        COLOR 20 20 20
        OUTLINECOLOR 255 255 255
        OUTLINEWIDTH 2
        FONT "dejavu-bold"
        TYPE TRUETYPE
        SIZE 11
        POSITION AUTO
        ANGLE FOLLOW
        BUFFER 2
        MINDISTANCE 80
        FORCE TRUE
        REPEATDISTANCE 150
      END
    END
    METADATA
      "wms_title" "2m Temperature (Numbers)"
      "wms_abstract" "Temperature values with dense labels"
      "wms_style" "numbers"
    END
  END

  #============================================================================
  # MSLP - GRADIENT STYLE
  #============================================================================
  LAYER
    NAME "mslp"
    GROUP "pressure"
    TYPE RASTER
    STATUS ON
    DATA "/data/gfs.t12z.pgrb2.0p25.f000.grb2"
    PROCESSING "BANDS=1"
    PROCESSING "RESAMPLE=BILINEAR"
    OFFSITE 0 0 0
    CLASS
      EXPRESSION ([pixel] < 99000)
      STYLE
        COLORRANGE 100 50 150  150 100 200
        DATARANGE 97000 99000
      END
    END
    CLASS
      EXPRESSION ([pixel] >= 99000 AND [pixel] < 101000)
      STYLE
        COLORRANGE 150 100 200  200 200 200
        DATARANGE 99000 101000
      END
    END
    CLASS
      EXPRESSION ([pixel] >= 101000 AND [pixel] < 103000)
      STYLE
        COLORRANGE 200 200 200  100 150 200
        DATARANGE 101000 103000
      END
    END
    CLASS
      EXPRESSION ([pixel] >= 103000)
      STYLE
        COLORRANGE 100 150 200  50 80 150
        DATARANGE 103000 105000
      END
    END
    METADATA
      "wms_title" "Mean Sea Level Pressure (Gradient)"
      "wms_abstract" "MSLP gradient colormap"
      "wms_style" "gradient"
    END
  END

  #============================================================================
  # MSLP - CONTOUR STYLE (isobars)
  #============================================================================
  LAYER
    NAME "mslp_contour"
    GROUP "pressure"
    TYPE LINE
    STATUS ON
    CONNECTIONTYPE CONTOUR
    DATA "/data/gfs.t12z.pgrb2.0p25.f000.grb2"
    PROCESSING "BANDS=1"
    PROCESSING "CONTOUR_INTERVAL=400"
    CLASS
      NAME "Isobars"
      STYLE
        COLOR 80 80 180
        WIDTH 1.5
      END
      LABEL
        COLOR 50 50 150
        OUTLINECOLOR 255 255 255
        FONT "dejavu-bold"
        TYPE TRUETYPE
        SIZE 9
        POSITION AUTO
        ANGLE FOLLOW
        BUFFER 3
        MINDISTANCE 150
      END
    END
    METADATA
      "wms_title" "Mean Sea Level Pressure (Contours)"
      "wms_abstract" "MSLP isobars every 4 hPa"
      "wms_style" "contour"
    END
  END

  #============================================================================
  # MSLP - NUMBERS STYLE (dense labels on thin contours)
  #============================================================================
  LAYER
    NAME "mslp_numbers"
    GROUP "pressure"
    TYPE LINE
    STATUS ON
    CONNECTIONTYPE CONTOUR
    DATA "/data/gfs.t12z.pgrb2.0p25.f000.grb2"
    PROCESSING "BANDS=1"
    PROCESSING "CONTOUR_INTERVAL=200"
    CLASS
      NAME "Pressure Labels"
      STYLE
        COLOR 200 200 200
        WIDTH 0.5
      END
      LABEL
        COLOR 20 20 20
        OUTLINECOLOR 255 255 255
        OUTLINEWIDTH 2
        FONT "dejavu-bold"
        TYPE TRUETYPE
        SIZE 10
        POSITION AUTO
        ANGLE FOLLOW
        BUFFER 2
        MINDISTANCE 80
        FORCE TRUE
        REPEATDISTANCE 120
      END
    END
    METADATA
      "wms_title" "Mean Sea Level Pressure (Numbers)"
      "wms_abstract" "MSLP with dense value labels"
      "wms_style" "numbers"
    END
  END

  #============================================================================
  # CAPE - GRADIENT STYLE
  #============================================================================
  LAYER
    NAME "cape"
    GROUP "instability"
    TYPE RASTER
    STATUS ON
    DATA "/data/gfs.t12z.pgrb2.0p25.f000.grb2"
    PROCESSING "BANDS=602"
    PROCESSING "RESAMPLE=BILINEAR"
    OFFSITE 0 0 0
    CLASS
      EXPRESSION ([pixel] < 500)
      STYLE
        COLORRANGE 220 240 220  180 220 180
        DATARANGE 0 500
      END
    END
    CLASS
      EXPRESSION ([pixel] >= 500 AND [pixel] < 1500)
      STYLE
        COLORRANGE 180 220 180  240 240 100
        DATARANGE 500 1500
      END
    END
    CLASS
      EXPRESSION ([pixel] >= 1500 AND [pixel] < 3000)
      STYLE
        COLORRANGE 240 240 100  240 160 60
        DATARANGE 1500 3000
      END
    END
    CLASS
      EXPRESSION ([pixel] >= 3000)
      STYLE
        COLORRANGE 240 160 60  180 40 40
        DATARANGE 3000 5000
      END
    END
    METADATA
      "wms_title" "CAPE (Gradient)"
      "wms_abstract" "CAPE gradient colormap"
      "wms_style" "gradient"
    END
  END

  #============================================================================
  # CAPE - CONTOUR STYLE
  #============================================================================
  LAYER
    NAME "cape_contour"
    GROUP "instability"
    TYPE LINE
    STATUS ON
    CONNECTIONTYPE CONTOUR
    DATA "/data/gfs.t12z.pgrb2.0p25.f000.grb2"
    PROCESSING "BANDS=602"
    PROCESSING "CONTOUR_INTERVAL=500"
    CLASS
      NAME "CAPE Contours"
      STYLE
        COLOR 180 100 0
        WIDTH 1.5
      END
      LABEL
        COLOR 140 60 0
        OUTLINECOLOR 255 255 255
        FONT "dejavu-bold"
        TYPE TRUETYPE
        SIZE 8
        POSITION AUTO
        ANGLE FOLLOW
        MINDISTANCE 200
      END
    END
    METADATA
      "wms_title" "CAPE (Contours)"
      "wms_abstract" "CAPE contour lines every 500 J/kg"
      "wms_style" "contour"
    END
  END

  #============================================================================
  # CAPE - NUMBERS STYLE (dense labels)
  #============================================================================
  LAYER
    NAME "cape_numbers"
    GROUP "instability"
    TYPE LINE
    STATUS ON
    CONNECTIONTYPE CONTOUR
    DATA "/data/gfs.t12z.pgrb2.0p25.f000.grb2"
    PROCESSING "BANDS=602"
    PROCESSING "CONTOUR_INTERVAL=250"
    CLASS
      NAME "CAPE Labels"
      STYLE
        COLOR 200 200 200
        WIDTH 0.5
      END
      LABEL
        COLOR 20 20 20
        OUTLINECOLOR 255 255 255
        OUTLINEWIDTH 2
        FONT "dejavu-bold"
        TYPE TRUETYPE
        SIZE 10
        POSITION AUTO
        ANGLE FOLLOW
        BUFFER 2
        MINDISTANCE 80
        FORCE TRUE
        REPEATDISTANCE 120
      END
    END
    METADATA
      "wms_title" "CAPE (Numbers)"
      "wms_abstract" "CAPE with dense value labels"
      "wms_style" "numbers"
    END
  END

  #============================================================================
  # PWAT - GRADIENT STYLE
  #============================================================================
  LAYER
    NAME "pwat"
    GROUP "moisture"
    TYPE RASTER
    STATUS ON
    DATA "/data/gfs.t12z.pgrb2.0p25.f000.grb2"
    PROCESSING "BANDS=604"
    PROCESSING "RESAMPLE=BILINEAR"
    OFFSITE 0 0 0
    CLASS
      EXPRESSION ([pixel] < 15)
      STYLE
        COLORRANGE 255 255 220  200 230 180
        DATARANGE 0 15
      END
    END
    CLASS
      EXPRESSION ([pixel] >= 15 AND [pixel] < 30)
      STYLE
        COLORRANGE 200 230 180  120 200 160
        DATARANGE 15 30
      END
    END
    CLASS
      EXPRESSION ([pixel] >= 30 AND [pixel] < 45)
      STYLE
        COLORRANGE 120 200 160  60 150 200
        DATARANGE 30 45
      END
    END
    CLASS
      EXPRESSION ([pixel] >= 45)
      STYLE
        COLORRANGE 60 150 200  30 60 140
        DATARANGE 45 70
      END
    END
    METADATA
      "wms_title" "Precipitable Water (Gradient)"
      "wms_abstract" "PWAT gradient colormap"
      "wms_style" "gradient"
    END
  END

  #============================================================================
  # PWAT - CONTOUR STYLE
  #============================================================================
  LAYER
    NAME "pwat_contour"
    GROUP "moisture"
    TYPE LINE
    STATUS ON
    CONNECTIONTYPE CONTOUR
    DATA "/data/gfs.t12z.pgrb2.0p25.f000.grb2"
    PROCESSING "BANDS=604"
    PROCESSING "CONTOUR_INTERVAL=10"
    CLASS
      NAME "PWAT Contours"
      STYLE
        COLOR 0 100 180
        WIDTH 1.5
      END
      LABEL
        COLOR 0 70 140
        OUTLINECOLOR 255 255 255
        FONT "dejavu-bold"
        TYPE TRUETYPE
        SIZE 8
        POSITION AUTO
        ANGLE FOLLOW
        MINDISTANCE 200
      END
    END
    METADATA
      "wms_title" "Precipitable Water (Contours)"
      "wms_abstract" "PWAT contour lines every 10 mm"
      "wms_style" "contour"
    END
  END

  #============================================================================
  # PWAT - NUMBERS STYLE (dense labels)
  #============================================================================
  LAYER
    NAME "pwat_numbers"
    GROUP "moisture"
    TYPE LINE
    STATUS ON
    CONNECTIONTYPE CONTOUR
    DATA "/data/gfs.t12z.pgrb2.0p25.f000.grb2"
    PROCESSING "BANDS=604"
    PROCESSING "CONTOUR_INTERVAL=5"
    CLASS
      NAME "PWAT Labels"
      STYLE
        COLOR 200 200 200
        WIDTH 0.5
      END
      LABEL
        COLOR 20 20 20
        OUTLINECOLOR 255 255 255
        OUTLINEWIDTH 2
        FONT "dejavu-bold"
        TYPE TRUETYPE
        SIZE 10
        POSITION AUTO
        ANGLE FOLLOW
        BUFFER 2
        MINDISTANCE 80
        FORCE TRUE
        REPEATDISTANCE 120
      END
    END
    METADATA
      "wms_title" "Precipitable Water (Numbers)"
      "wms_abstract" "PWAT with dense value labels"
      "wms_style" "numbers"
    END
  END

  #============================================================================
  # Remaining layers with gradient only (for backward compatibility)
  #============================================================================
  
  LAYER
    NAME "rh2m"
    TYPE RASTER
    STATUS ON
    DATA "/data/gfs.t12z.pgrb2.0p25.f000.grb2"
    PROCESSING "BANDS=583"
    PROCESSING "RESAMPLE=BILINEAR"
    OFFSITE 0 0 0
    CLASS
      EXPRESSION ([pixel] < 30)
      STYLE
        COLORRANGE 180 100 50  220 180 100
        DATARANGE 0 30
      END
    END
    CLASS
      EXPRESSION ([pixel] >= 30 AND [pixel] < 60)
      STYLE
        COLORRANGE 220 180 100  150 200 150
        DATARANGE 30 60
      END
    END
    CLASS
      EXPRESSION ([pixel] >= 60 AND [pixel] < 80)
      STYLE
        COLORRANGE 150 200 150  80 160 200
        DATARANGE 60 80
      END
    END
    CLASS
      EXPRESSION ([pixel] >= 80)
      STYLE
        COLORRANGE 80 160 200  30 80 160
        DATARANGE 80 100
      END
    END
    METADATA
      "wms_title" "2m Relative Humidity"
      "wms_abstract" "Relative humidity at 2 meters"
    END
  END

  LAYER
    NAME "gust"
    TYPE RASTER
    STATUS ON
    DATA "/data/gfs.t12z.pgrb2.0p25.f000.grb2"
    PROCESSING "BANDS=14"
    PROCESSING "RESAMPLE=BILINEAR"
    OFFSITE 0 0 0
    CLASS
      EXPRESSION ([pixel] < 5)
      STYLE
        COLORRANGE 200 230 200  150 210 150
        DATARANGE 0 5
      END
    END
    CLASS
      EXPRESSION ([pixel] >= 5 AND [pixel] < 15)
      STYLE
        COLORRANGE 150 210 150  100 180 220
        DATARANGE 5 15
      END
    END
    CLASS
      EXPRESSION ([pixel] >= 15 AND [pixel] < 25)
      STYLE
        COLORRANGE 100 180 220  220 220 80
        DATARANGE 15 25
      END
    END
    CLASS
      EXPRESSION ([pixel] >= 25 AND [pixel] < 35)
      STYLE
        COLORRANGE 220 220 80  220 140 50
        DATARANGE 25 35
      END
    END
    CLASS
      EXPRESSION ([pixel] >= 35)
      STYLE
        COLORRANGE 220 140 50  180 40 40
        DATARANGE 35 60
      END
    END
    METADATA
      "wms_title" "Wind Gust"
      "wms_abstract" "Wind gust speed at surface"
    END
  END

  LAYER
    NAME "refc"
    TYPE RASTER
    STATUS ON
    DATA "/data/gfs.t12z.pgrb2.0p25.f000.grb2"
    PROCESSING "BANDS=9"
    PROCESSING "RESAMPLE=BILINEAR"
    OFFSITE 0 0 0
    CLASS
      EXPRESSION ([pixel] < 20)
      STYLE
        COLORRANGE 200 200 200  100 200 100
        DATARANGE 0 20
      END
    END
    CLASS
      EXPRESSION ([pixel] >= 20 AND [pixel] < 35)
      STYLE
        COLORRANGE 100 200 100  240 240 60
        DATARANGE 20 35
      END
    END
    CLASS
      EXPRESSION ([pixel] >= 35 AND [pixel] < 50)
      STYLE
        COLORRANGE 240 240 60  240 100 50
        DATARANGE 35 50
      END
    END
    CLASS
      EXPRESSION ([pixel] >= 50)
      STYLE
        COLORRANGE 240 100 50  180 30 120
        DATARANGE 50 75
      END
    END
    METADATA
      "wms_title" "Composite Reflectivity"
      "wms_abstract" "Simulated radar reflectivity"
    END
  END

  LAYER
    NAME "vis"
    TYPE RASTER
    STATUS ON
    DATA "/data/gfs.t12z.pgrb2.0p25.f000.grb2"
    PROCESSING "BANDS=10"
    PROCESSING "RESAMPLE=BILINEAR"
    OFFSITE 0 0 0
    CLASS
      EXPRESSION ([pixel] < 1000)
      STYLE
        COLORRANGE 120 60 80  180 120 140
        DATARANGE 0 1000
      END
    END
    CLASS
      EXPRESSION ([pixel] >= 1000 AND [pixel] < 5000)
      STYLE
        COLORRANGE 180 120 140  220 200 180
        DATARANGE 1000 5000
      END
    END
    CLASS
      EXPRESSION ([pixel] >= 5000 AND [pixel] < 15000)
      STYLE
        COLORRANGE 220 200 180  180 220 240
        DATARANGE 5000 15000
      END
    END
    CLASS
      EXPRESSION ([pixel] >= 15000)
      STYLE
        COLORRANGE 180 220 240  100 180 240
        DATARANGE 15000 24000
      END
    END
    METADATA
      "wms_title" "Visibility"
      "wms_abstract" "Surface visibility"
    END
  END

END
